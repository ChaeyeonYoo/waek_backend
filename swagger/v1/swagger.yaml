---
openapi: 3.0.1
info:
  title: 왹왹이(waek) API
  version: v1
  description: 왹왹이 iOS 앱을 위한 RESTful API 서버
  contact:
    name: API Support
paths:
  "/auth/social/verify":
    post:
      summary: 소셜 유저 존재 확인 + 로그인
      tags:
      - 인증
      description: 소셜 계정으로 가입한 적이 있는지 확인하고, 있으면 로그인합니다.
      parameters: []
      responses:
        '200':
          description: 기존 유저가 아닌 경우 (회원가입 필요)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: NEED_SIGNUP
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      username:
                        type: string
                      nickname:
                        type: string
                      profile_image_code:
                        type: integer
                      provider:
                        type: string
                  token:
                    type: object
                    properties:
                      access_token:
                        type: string
                      token_type:
                        type: string
                        example: Bearer
                      expires_in:
                        type: integer
                        example: 3600
                  provider:
                    type: string
        '400':
          description: 필수 필드 누락
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                provider:
                  type: string
                  enum:
                  - kakao
                  - google
                  - apple
                  example: kakao
                provider_id:
                  type: string
                  example: '123456'
              required:
              - provider
              - provider_id
  "/auth/social/signup":
    post:
      summary: 회원가입
      tags:
      - 인증
      description: 최초 회원가입을 진행합니다.
      parameters: []
      responses:
        '201':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: integer
                      username:
                        type: string
                      nickname:
                        type: string
                      profile_image_code:
                        type: integer
                      provider:
                        type: string
                      created_at:
                        type: string
                      updated_at:
                        type: string
                  token:
                    type: object
                    properties:
                      access_token:
                        type: string
                      token_type:
                        type: string
                        example: Bearer
                      expires_in:
                        type: integer
                        example: 3600
        '400':
          description: 필수 필드 누락
        '409':
          description: username 중복
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                provider:
                  type: string
                  enum:
                  - kakao
                  - google
                  - apple
                  example: kakao
                provider_id:
                  type: string
                  example: '123456'
                username:
                  type: string
                  example: waek_chae
                nickname:
                  type: string
                  example: 채연
                profile_image_code:
                  type: integer
                  example: 2
                  description: 0~4 사이의 값
                social_email:
                  type: string
                  example: test@example.com
                  description: 선택사항
              required:
              - provider
              - provider_id
              - username
              - nickname
  "/users/check_id":
    get:
      summary: username 중복 확인
      tags:
      - 인증
      description: username이 사용 가능한지 확인합니다.
      parameters:
      - name: username
        in: query
        required: true
        example: waek_chae
        schema:
          type: string
      responses:
        '200':
          description: 사용 불가능 (중복)
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                  available:
                    type: boolean
                    example: false
  "/me":
    get:
      summary: 내 정보 조회
      tags:
      - 인증
      description: 현재 로그인한 사용자의 정보를 조회합니다.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  username:
                    type: string
                  nickname:
                    type: string
                  profile_image_code:
                    type: integer
                  provider:
                    type: string
                  created_at:
                    type: string
                  updated_at:
                    type: string
        '401':
          description: 인증 실패
    delete:
      summary: 계정 삭제
      tags:
      - 인증
      description: 계정을 soft delete 처리합니다.
      security:
      - bearerAuth: []
      responses:
        '204':
          description: 삭제 성공
  "/auth/logout":
    post:
      summary: 로그아웃
      tags:
      - 인증
      description: 로그아웃합니다. (token_version +1)
      security:
      - bearerAuth: []
      responses:
        '204':
          description: 로그아웃 성공
  "/feedbacks":
    post:
      summary: 피드백 작성
      tags:
      - 피드백
      description: 피드백을 작성합니다.
      security:
      - bearerAuth: []
      parameters: []
      responses:
        '201':
          description: 피드백 작성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  content:
                    type: string
                  created_at:
                    type: string
        '400':
          description: 필수 필드 누락
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content:
                  type: string
                  example: "왹왹이 너무 귀여워요! 산책할 때 동기부여 돼요 \U0001F423"
                device_type:
                  type: string
                  enum:
                  - ios
                  - android
                  - web
                  example: ios
                app_version:
                  type: string
                  example: 1.0.3
              required:
              - content
              - device_type
              - app_version
  "/admin/feedbacks":
    get:
      summary: 피드백 목록 조회 (관리자용)
      tags:
      - 피드백
      description: 모든 피드백을 조회합니다. (관리자용)
      security:
      - bearerAuth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        user:
                          type: object
                          properties:
                            id:
                              type: integer
                            username:
                              type: string
                            nickname:
                              type: string
                        content:
                          type: string
                        created_at:
                          type: string
                  total_count:
                    type: integer
  "/me/subscription":
    get:
      summary: 구독 상태 조회
      tags:
      - 구독
      description: 현재 사용자의 구독 상태를 조회합니다.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  type:
                    type: string
                    enum:
                    - paid
                    - trial
                    - none
                    example: none
                  is_subscribed:
                    type: boolean
                  is_trial:
                    type: boolean
                  is_expired:
                    type: boolean
                  has_used_trial:
                    type: boolean
                  subscription_expires_at:
                    type: string
                    nullable: true
                  trial_expires_at:
                    type: string
                    nullable: true
                  days_left:
                    type: integer
    post:
      summary: 구독 활성화
      tags:
      - 구독
      description: iOS 결제 후 구독을 활성화합니다.
      security:
      - bearerAuth: []
      parameters: []
      responses:
        '200':
          description: 구독 활성화 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: subscribed
                  subscription_expires_at:
                    type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                platform:
                  type: string
                  example: ios
                transaction_id:
                  type: string
                  example: '1000000899921234'
                expires_at:
                  type: string
                  format: date-time
                  example: '2025-08-01T10:00:00Z'
                auto_renew:
                  type: boolean
                  example: true
              required:
              - platform
              - transaction_id
              - expires_at
    delete:
      summary: 구독 해지
      tags:
      - 구독
      description: 구독을 해지합니다.
      security:
      - bearerAuth: []
      responses:
        '200':
          description: 구독 해지 성공
  "/me/subscription/trial":
    post:
      summary: 무료체험 시작
      tags:
      - 구독
      description: 무료체험을 시작합니다. (1회 한정)
      security:
      - bearerAuth: []
      responses:
        '204':
          description: 무료체험 시작 성공
        '400':
          description: 이미 무료체험 사용함
  "/uploads/presigned_url":
    post:
      summary: Presigned URL 발급
      tags:
      - 산책 기록
      description: 산책 사진 업로드용 S3 presigned URL을 발급합니다.
      security:
      - bearerAuth: []
      parameters: []
      responses:
        '200':
          description: Presigned URL 발급 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  upload_url:
                    type: string
                    description: S3 업로드용 presigned URL
                  photo_key:
                    type: string
                    description: DB에 저장할 S3 key
                  expires_in:
                    type: integer
                    example: 600
                    description: 유효 시간 (초)
        '401':
          description: 인증 실패
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                content_type:
                  type: string
                  example: image/png
                  description: image/jpeg, image/png 등
                use_case:
                  type: string
                  example: walk_card
                  description: 선택사항
  "/walks":
    post:
      summary: 산책 기록 생성
      tags:
      - 산책 기록
      description: 새로운 산책 기록을 생성합니다.
      security:
      - bearerAuth: []
      parameters: []
      responses:
        '201':
          description: 산책 기록 생성 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  distance_meters:
                    type: integer
                  step_count:
                    type: integer
                  duration_seconds:
                    type: integer
                  started_at:
                    type: string
                  ended_at:
                    type: string
                  photo:
                    type: object
                    properties:
                      key:
                        type: string
                      url:
                        type: string
                        description: Presigned GET URL
                  created_at:
                    type: string
                  updated_at:
                    type: string
        '400':
          description: 필수 필드 누락
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                walk:
                  type: object
                  properties:
                    distance_meters:
                      type: integer
                      example: 2700
                    step_count:
                      type: integer
                      example: 2380
                    duration_seconds:
                      type: integer
                      example: 1800
                    started_at:
                      type: string
                      format: date-time
                      example: '2025-07-12T01:30:00Z'
                    ended_at:
                      type: string
                      format: date-time
                      example: '2025-07-12T02:00:00Z'
                    photo_key:
                      type: string
                      example: walks/user_1/2025/07/12/uuid.png
                  required:
                  - started_at
                  - ended_at
                  - duration_seconds
    get:
      summary: 산책 기록 목록 조회
      tags:
      - 산책 기록
      description: 산책 기록 목록을 조회합니다.
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        required: false
        example: 1
        schema:
          type: integer
      - name: per_page
        in: query
        required: false
        example: 20
        schema:
          type: integer
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        date:
                          type: string
                        distance_meters:
                          type: integer
                        step_count:
                          type: integer
                        duration_seconds:
                          type: integer
                        photo:
                          type: object
                          properties:
                            key:
                              type: string
                            url:
                              type: string
                        created_at:
                          type: string
                        updated_at:
                          type: string
                  page:
                    type: integer
                  per_page:
                    type: integer
                  total_count:
                    type: integer
  "/walks/{id}":
    get:
      summary: 산책 기록 상세 조회
      tags:
      - 산책 기록
      description: 특정 산책 기록의 상세 정보를 조회합니다.
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        example: 1
        schema:
          type: integer
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  distance_meters:
                    type: integer
                  step_count:
                    type: integer
                  duration_seconds:
                    type: integer
                  started_at:
                    type: string
                  ended_at:
                    type: string
                  photo:
                    type: object
                    properties:
                      key:
                        type: string
                      url:
                        type: string
                  created_at:
                    type: string
                  updated_at:
                    type: string
        '404':
          description: 기록을 찾을 수 없음
    delete:
      summary: 산책 기록 삭제
      tags:
      - 산책 기록
      description: 산책 기록을 soft delete 처리합니다.
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        example: 1
        schema:
          type: integer
      responses:
        '204':
          description: 삭제 성공
servers:
- url: http://localhost:3000
  description: Development server
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: your-production-server.com
  description: Production server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
